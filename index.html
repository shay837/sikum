<!DOCTYPE html>
<html lang="he" dir="rtl">
  <head>
    <title>סיכום - פשוט לקרוא חכם</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="index.css" />
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom": "https://esm.sh/react-dom@18.2.0"
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel">
      import React from "react";
      import ReactDOM from "react-dom";

      // --- ICONS --- //
      const BookIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M20 2H4C2.9 2 2 2.9 2 4V20C2 21.1 2.9 22 4 22H20C21.1 22 22 21.1 22 20V4C22 2.9 21.1 2 20 2ZM11 18H6V6H11V18ZM18 18H13V6H18V18Z" />
        </svg>
      );
      const ClockIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2ZM12 20C7.58172 20 4 16.4183 4 12C4 7.58172 7.58172 4 12 4C16.4183 4 20 7.58172 20 12C20 16.4183 16.4183 20 12 20ZM13 7H11V12.5L16.5 15.3L17.5 13.9L13 11.5V7Z" />
        </svg>
      );
      const SearchIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
          <path d="M11 2C15.968 2 20 6.032 20 11C20 15.968 15.968 20 11 20C6.032 20 2 15.968 2 11C2 6.032 6.032 2 11 2ZM11 18C14.8675 18 18 14.8675 18 11C18 7.1325 14.8675 4 11 4C7.1325 4 4 7.1325 4 11C4 14.8675 7.1325 18 11 18ZM19.4853 18.0711L22.3137 20.8995L20.8995 22.3137L18.0711 19.4853L19.4853 18.0711Z"/>
        </svg>
      );
      const CrownIcon = () => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2L9.5 7L3 7.5L7.5 12L6 18L12 15L18 18L16.5 12L21 7.5L14.5 7L12 2Z" />
        </svg>
      );
      const StarIcon = ({ isFavorite }) => (
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className={`star-icon ${isFavorite ? 'favorite' : ''}`}>
          <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21 12 17.27z"/>
        </svg>
      );

      // --- INITIAL DATA & LOCAL STORAGE --- //
      const INITIAL_BOOKS = [
        { id: '1', title: 'הנביא', author: 'ג׳ובראן חליל ג׳ובראן', genre: 'פילוסופיה', summary: 'ספר שירה ונבואה המדבר על אהבה, עבודה, שמחה וצער.', readingTime: 8, isRecommended: true, coverImage: 'https://placehold.co/100x100/2b3a67/ffffff?text=הנביא' },
        { id: '2', title: 'חשיבה מהירה ואיטית', author: 'דניאל כהנמן', genre: 'פסיכולוגיה', summary: 'בוחן את שתי מערכות החשיבה המניעות את האופן בו אנו חושבים.', readingTime: 15, isRecommended: true },
        { id: '3', title: 'קיצור תולדות האנושות', author: 'יובל נח הררי', genre: 'היסטוריה', summary: 'סקירה רחבה של ההיסטוריה האנושית מהאדם הקדמון ועד ימינו.', readingTime: 18, isRecommended: true, coverImage: 'https://placehold.co/100x100/2b3a67/ffffff?text=קיצור' },
        { id: '4', title: 'האומץ להיות לא אהוד', author: 'איצ׳ירו קישימי', genre: 'פסיכולוגיה', summary: 'דיאלוג בין פילוסוף לצעיר הבוחן את תורתו של אלפרד אדלר.', readingTime: 10, isRecommended: false },
        { id: '5', title: 'האלכימאי', author: 'פאולו קואלו', genre: 'ספרות', summary: 'רועה צאן במסע לגילוי אוצר, שמתגלה כמסע לגילוי עצמי.', readingTime: 7, isRecommended: false },
      ];

      function useLocalStorage(key, initialValue) {
        const [storedValue, setStoredValue] = React.useState(() => {
          try {
            const item = window.localStorage.getItem(key);
            return item ? JSON.parse(item) : initialValue;
          } catch (error) { console.error(error); return initialValue; }
        });
        const setValue = (value) => {
          try {
            const valueToStore = value instanceof Function ? value(storedValue) : value;
            setStoredValue(valueToStore);
            window.localStorage.setItem(key, JSON.stringify(valueToStore));
          } catch (error) { console.error(error); }
        };
        return [storedValue, setValue];
      }

      // --- ROUTING --- //
      function useHashRouter() {
        const [route, setInternalRoute] = React.useState(parseHash(window.location.hash));
        React.useEffect(() => {
          const handleHashChange = () => setInternalRoute(parseHash(window.location.hash));
          window.addEventListener('hashchange', handleHashChange);
          return () => window.removeEventListener('hashchange', handleHashChange);
        }, []);
        const setRoute = (newRoute) => { window.location.hash = formatHash(newRoute); };
        return [route, setRoute];
      }

      function parseHash(hash) {
        const path = hash.replace(/^#\/?/, '');
        const parts = path.split('/');
        switch (parts[0]) {
          case 'book':
            if (parts[1]) return { page: 'book', bookId: parts[1] };
            break;
          case 'edit':
            if (parts[1]) return { page: 'form', bookId: parts[1] };
            break;
          case 'new':
            return { page: 'form' };
          case 'browse':
            return { page: 'browse' };
          case 'admin':
            return { page: 'admin' };
          case 'favorites':
            return { page: 'favorites' };
          case 'dashboard':
            return { page: 'dashboard' };
          case 'home':
          case '':
            return { page: 'home' };
        }
        return { page: 'home' };
      }

      function formatHash(route) {
        if (route.page === 'book') return `book/${route.bookId}`;
        if (route.page === 'form') return route.bookId ? `edit/${route.bookId}` : 'new';
        if (route.page === 'browse') return 'browse';
        if (route.page === 'admin') return 'admin';
        if (route.page === 'favorites') return 'favorites';
        if (route.page === 'dashboard') return 'dashboard';
        return 'home';
      }

      // --- COMPONENTS --- //
      // [הקומפוננטות: Header, SummaryCard, BookGrid, HeroSection, HomePage, BrowsePage, FavoritesPage, DashboardPage, SummaryDetailView, SummaryForm, AdminLoginPage]
      // (הקוד שלהן בדיוק כמו בתשובות הקודמות, אם תרצה אותן שוב מלאות – כתוב לי!)

      // --- MAIN APP --- //
      function App() {
        const [books, setBooks] = useLocalStorage('sikum-books-v3', INITIAL_BOOKS);
        const [favoriteIds, setFavoriteIds] = useLocalStorage('sikum-favorites-v1', []);
        const [route, setRoute] = useHashRouter();
        const [isAdmin, setIsAdmin] = React.useState(() => sessionStorage.getItem('sikum-is-admin') === 'true');
        const [initialQuery, setInitialQuery] = React.useState('');

        const handleToggleFavorite = (bookId) => {
          setFavoriteIds(prev => prev.includes(bookId) ? prev.filter(id => id !== bookId) : [...prev, bookId]);
        }

        const handleSaveBook = (bookToSave) => {
          setBooks(prev => {
            const exists = prev.some(b => b.id === bookToSave.id);
            return exists ? prev.map(b => b.id === bookToSave.id ? bookToSave : b) : [...prev, bookToSave];
          });
          setRoute({ page: 'browse' });
        };
        
        const handleDeleteBook = (id) => {
          setBooks(prev => prev.filter(b => b.id !== id));
          setFavoriteIds(prev => prev.filter(favId => favId !== id));
          setRoute({ page: 'browse' });
        };

        const handleLogin = (password) => {
          if (password === 'admin123') {
            sessionStorage.setItem('sikum-is-admin', 'true');
            setIsAdmin(true);
            setRoute({ page: 'home' });
            return true;
          }
          return false;
        }

        const handleLogout = () => {
          sessionStorage.removeItem('sikum-is-admin');
          setIsAdmin(false);
          setRoute({ page: 'home' });
        }
        
        const handleHomepageSearch = (query) => {
          setInitialQuery(query);
          setRoute({ page: 'browse' });
        }

        const onQueryHandled = React.useCallback(() => {
          setInitialQuery('');
        }, []);

        const renderContent = () => {
          if (route.page === 'admin') {
            return <AdminLoginPage onLogin={handleLogin} />;
          }
          if (route.page === 'dashboard') {
            if (!isAdmin) return <p className="container text-center">אין לך הרשאה לגשת לדף זה.</p>;
            return <DashboardPage books={books} />;
          }
          if (route.page === 'favorites') {
            return <FavoritesPage books={books} onNavigate={setRoute} onToggleFavorite={handleToggleFavorite} favoriteIds={favoriteIds} />;
          }
          if (route.page === 'form') {
            if (!isAdmin) return <p className="container text-center">אין לך הרשאה לגשת לדף זה.</p>;
            const bookToEdit = route.bookId ? books.find(b => b.id === route.bookId) : undefined;
            return <SummaryForm book={bookToEdit} onSave={handleSaveBook} onCancel={() => setRoute({ page: 'browse' })} />;
          }
          if (route.page === 'book') {
            const book = books.find(b => b.id === route.bookId);
            return book ? <SummaryDetailView book={book} onNavigate={setRoute} onDelete={handleDeleteBook} isAdmin={isAdmin} onToggleFavorite={handleToggleFavorite} isFavorite={favoriteIds.includes(book.id)} /> : <p className="container text-center">ספר לא נמצא.</p>;
          }
          if (route.page === 'browse') {
            return <BrowsePage books={books} onNavigate={setRoute} initialQuery={initialQuery} onQueryHandled={onQueryHandled} onToggleFavorite={handleToggleFavorite} favoriteIds={favoriteIds} />;
          }
          return <HomePage books={books} onNavigate={setRoute} onSearch={handleHomepageSearch} onToggleFavorite={handleToggleFavorite} favoriteIds={favoriteIds} />;
        };

        return (
          <>
            <Header onNavigate={setRoute} isAdmin={isAdmin} onLogout={handleLogout} route={route} />
            <main>
              {renderContent()}
            </main>
          </>
        );
      }

      ReactDOM.render(<App />, document.getElementById("root"));
    </script>
  </body>
</html>
